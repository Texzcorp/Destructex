<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Bot Setup avec Logs</title>
    <style>
        #log {
            width: 100%;
            height: 300px;
            border: 1px solid black;
            padding: 10px;
            overflow-y: scroll;
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>
    <h1>Configurer le Bot Twitch</h1>
    <form id="twitch-form">
        <label for="channel">Nom du Channel Twitch:</label><br>
        <input type="text" id="channel" name="channel" placeholder="Entrez le nom du channel"><br><br>
        <button type="button" onclick="startAuth()">Se connecter à Twitch</button>
    </form>
    
    <h2>Logs</h2>
    <div id="log">En attente de démarrage...</div>

    <script>
        function startAuth() {
            const clientId = 'xmezn3bhtuaef389py1qirybnb26t9'; // Ton client_id
            const redirectUri = 'https://texzcorp.github.io/Destructex'; // Remplace par l'URL GitHub Pages
            const scope = 'chat:read chat:edit';
            const state = Math.random().toString(36).substring(7); // Générer un état aléatoire pour CSRF

            const channel = document.getElementById('channel').value;
            if (channel === '') {
                alert('Veuillez entrer un nom de channel.');
                return;
            }

            // Enregistrer le channel dans le localStorage pour qu'il soit utilisé après redirection
            localStorage.setItem('twitch_channel', channel);

            // Créer l'URL d'autorisation
            const authUrl = `https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scope}&state=${state}`;
            
            // Rediriger l'utilisateur vers l'URL d'autorisation
            window.location.href = authUrl;
        }

        // Lors du retour après autorisation
        window.onload = function() {
            const hash = window.location.hash.substr(1);
            const result = hash.split('&').reduce(function (res, item) {
                const parts = item.split('=');
                res[parts[0]] = parts[1];
                return res;
            }, {});

            const token = result['access_token'];
            if (token) {
                const channel = localStorage.getItem('twitch_channel');
                if (channel) {
                    // Stocker le token et le channel pour le bot
                    localStorage.setItem('oauth_token', token);
                    localStorage.setItem('channel', channel);

                    logMessage(`Bot configuré pour le channel ${channel}. Token récupéré.`);
                    
                    // Appeler une fonction de démarrage du bot avec le token et le channel
                    startBot(channel, token);
                } else {
                    logMessage('Channel non trouvé.');
                }
            }
        };

        // Fonction pour logguer des messages sur l'interface
        function logMessage(message) {
            const logDiv = document.getElementById('log');
            const currentTime = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${currentTime}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;  // Scroller vers le bas automatiquement
        }

        // Simuler l'exécution du bot et afficher les logs
        function startBot(channel, token) {
            logMessage('Connexion au bot...');
            // Simuler la connexion au bot
            setTimeout(() => {
                logMessage(`Bot connecté au channel: ${channel}`);
                simulateChatMessages();
            }, 1000);
        }

        // Simuler des messages de chat détectés
        function simulateChatMessages() {
            const messages = [
                'Salut tout le monde!',
                'Comment ça va?',
                'On parle de quoi aujourd\'hui?',
                'J\'adore ce stream!'
            ];

            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                if (messageIndex < messages.length) {
                    logMessage(`Message détecté: ${messages[messageIndex]}`);
                    messageIndex++;
                } else {
                    clearInterval(messageInterval);
                    logMessage('Fin des messages simulés.');
                }
            }, 2000);
        }
    </script>
</body>
</html>
